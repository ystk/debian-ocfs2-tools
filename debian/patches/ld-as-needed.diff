Index: ocfs2-tools-1.6.3/configure
===================================================================
--- ocfs2-tools-1.6.3.orig/configure	2010-09-16 12:36:13.000000000 -0500
+++ ocfs2-tools-1.6.3/configure	2011-01-13 12:29:56.000000000 -0600
@@ -309,7 +309,7 @@
 # include <unistd.h>
 #endif"
 
-ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS PACKAGE MAJOR_VERSION MINOR_VERSION MICRO_VERSION EXTRA_VERSION DIST_VERSION VERSION build build_cpu build_vendor build_os host host_cpu host_vendor host_os OCFS2_DEBUG CC CFLAGS LDFLAGS CPPFLAGS ac_ct_CC EXEEXT OBJEXT CPP INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA LN_S RANLIB ac_ct_RANLIB AR EGREP VENDOR root_prefix root_bindir root_sbindir root_sysconfdir PKG_CONFIG COM_ERR_CFLAGS COM_ERR_LIBS UUID_LIBS NCURSES_LIBS READLINE_LIBS OCFS2_DEBUG_EXE GLIB_CFLAGS GLIB_LIBS GLIB_GENMARSHAL GOBJECT_QUERY GLIB_MKENUMS OCFS2_DYNAMIC_FSCK OCFS2_DYNAMIC_CTL BUILD_DEBUGOCFS2 HAVE_COROSYNC CPG_LDFLAGS AIS_LDFLAGS LIBDLM_FOUND BUILD_FSDLM_SUPPORT DL_LIBS BUILD_OCFS2_CONTROLD BUILD_PCMK_SUPPORT BUILD_CMAN_SUPPORT PYTHON PYTHON_VERSION PYTHON_PREFIX PYTHON_EXEC_PREFIX PYTHON_PLATFORM pythondir pkgpythondir pyexecdir pkgpyexecdir PYTHON_INCLUDES BLKID_CFLAGS BLKID_LIBS HAVE_BLKID BUILD_OCFS2CONSOLE LIBOBJS LTLIBOBJS'
+ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS PACKAGE MAJOR_VERSION MINOR_VERSION MICRO_VERSION EXTRA_VERSION DIST_VERSION VERSION build build_cpu build_vendor build_os host host_cpu host_vendor host_os OCFS2_DEBUG CC CFLAGS LDFLAGS CPPFLAGS ac_ct_CC EXEEXT OBJEXT CPP INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA LN_S RANLIB ac_ct_RANLIB AR EGREP VENDOR root_prefix root_bindir root_sbindir root_sysconfdir PKG_CONFIG PKG_CONFIG_PATH PKG_CONFIG_LIBDIR ac_pt_PKG_CONFIG COM_ERR_CFLAGS COM_ERR_LIBS UUID_LIBS NCURSES_LIBS READLINE_LIBS OCFS2_DEBUG_EXE GLIB_CFLAGS GLIB_LIBS GLIB_GENMARSHAL GOBJECT_QUERY GLIB_MKENUMS OCFS2_DYNAMIC_FSCK OCFS2_DYNAMIC_CTL BUILD_DEBUGOCFS2 HAVE_COROSYNC CPG_LDFLAGS AIS_LDFLAGS LIBDLM_FOUND BUILD_FSDLM_SUPPORT DL_LIBS BUILD_OCFS2_CONTROLD BUILD_PCMK_SUPPORT BUILD_CMAN_SUPPORT PYTHON PYTHON_VERSION PYTHON_PREFIX PYTHON_EXEC_PREFIX PYTHON_PLATFORM pythondir pkgpythondir pyexecdir pkgpyexecdir PYTHON_INCLUDES BLKID_CFLAGS BLKID_LIBS HAVE_BLKID BUILD_OCFS2CONSOLE LIBOBJS LTLIBOBJS'
 ac_subst_files=''
 
 # Initialize some variables set by options.
@@ -770,6 +770,34 @@
 ac_env_CPP_value=$CPP
 ac_cv_env_CPP_set=${CPP+set}
 ac_cv_env_CPP_value=$CPP
+ac_env_PKG_CONFIG_set=${PKG_CONFIG+set}
+ac_env_PKG_CONFIG_value=$PKG_CONFIG
+ac_cv_env_PKG_CONFIG_set=${PKG_CONFIG+set}
+ac_cv_env_PKG_CONFIG_value=$PKG_CONFIG
+ac_env_PKG_CONFIG_PATH_set=${PKG_CONFIG_PATH+set}
+ac_env_PKG_CONFIG_PATH_value=$PKG_CONFIG_PATH
+ac_cv_env_PKG_CONFIG_PATH_set=${PKG_CONFIG_PATH+set}
+ac_cv_env_PKG_CONFIG_PATH_value=$PKG_CONFIG_PATH
+ac_env_PKG_CONFIG_LIBDIR_set=${PKG_CONFIG_LIBDIR+set}
+ac_env_PKG_CONFIG_LIBDIR_value=$PKG_CONFIG_LIBDIR
+ac_cv_env_PKG_CONFIG_LIBDIR_set=${PKG_CONFIG_LIBDIR+set}
+ac_cv_env_PKG_CONFIG_LIBDIR_value=$PKG_CONFIG_LIBDIR
+ac_env_COM_ERR_CFLAGS_set=${COM_ERR_CFLAGS+set}
+ac_env_COM_ERR_CFLAGS_value=$COM_ERR_CFLAGS
+ac_cv_env_COM_ERR_CFLAGS_set=${COM_ERR_CFLAGS+set}
+ac_cv_env_COM_ERR_CFLAGS_value=$COM_ERR_CFLAGS
+ac_env_COM_ERR_LIBS_set=${COM_ERR_LIBS+set}
+ac_env_COM_ERR_LIBS_value=$COM_ERR_LIBS
+ac_cv_env_COM_ERR_LIBS_set=${COM_ERR_LIBS+set}
+ac_cv_env_COM_ERR_LIBS_value=$COM_ERR_LIBS
+ac_env_BLKID_CFLAGS_set=${BLKID_CFLAGS+set}
+ac_env_BLKID_CFLAGS_value=$BLKID_CFLAGS
+ac_cv_env_BLKID_CFLAGS_set=${BLKID_CFLAGS+set}
+ac_cv_env_BLKID_CFLAGS_value=$BLKID_CFLAGS
+ac_env_BLKID_LIBS_set=${BLKID_LIBS+set}
+ac_env_BLKID_LIBS_value=$BLKID_LIBS
+ac_cv_env_BLKID_LIBS_set=${BLKID_LIBS+set}
+ac_cv_env_BLKID_LIBS_value=$BLKID_LIBS
 
 #
 # Report the --help message.
@@ -865,6 +893,18 @@
   CPPFLAGS    C/C++ preprocessor flags, e.g. -I<include dir> if you have
               headers in a nonstandard directory <include dir>
   CPP         C preprocessor
+  PKG_CONFIG  path to pkg-config utility
+  PKG_CONFIG_PATH
+              directories to add to pkg-config's search path
+  PKG_CONFIG_LIBDIR
+              path overriding pkg-config's built-in search path
+  COM_ERR_CFLAGS
+              C compiler flags for COM_ERR, overriding pkg-config
+  COM_ERR_LIBS
+              linker flags for COM_ERR, overriding pkg-config
+  BLKID_CFLAGS
+              C compiler flags for BLKID, overriding pkg-config
+  BLKID_LIBS  linker flags for BLKID, overriding pkg-config
 
 Use these variables to override the choices made by `configure' or to help
 it to find libraries and programs with nonstandard names/locations.
@@ -3194,6 +3234,114 @@
 
 
 COM_ERR_LIBS=
+
+
+
+
+
+
+if test "x$ac_cv_env_PKG_CONFIG_set" != "xset"; then
+	if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}pkg-config", so it can be a program name with args.
+set dummy ${ac_tool_prefix}pkg-config; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_path_PKG_CONFIG+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  case $PKG_CONFIG in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+  ;;
+esac
+fi
+PKG_CONFIG=$ac_cv_path_PKG_CONFIG
+
+if test -n "$PKG_CONFIG"; then
+  echo "$as_me:$LINENO: result: $PKG_CONFIG" >&5
+echo "${ECHO_T}$PKG_CONFIG" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+fi
+if test -z "$ac_cv_path_PKG_CONFIG"; then
+  ac_pt_PKG_CONFIG=$PKG_CONFIG
+  # Extract the first word of "pkg-config", so it can be a program name with args.
+set dummy pkg-config; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_path_ac_pt_PKG_CONFIG+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  case $ac_pt_PKG_CONFIG in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_ac_pt_PKG_CONFIG="$ac_pt_PKG_CONFIG" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_ac_pt_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+  ;;
+esac
+fi
+ac_pt_PKG_CONFIG=$ac_cv_path_ac_pt_PKG_CONFIG
+
+if test -n "$ac_pt_PKG_CONFIG"; then
+  echo "$as_me:$LINENO: result: $ac_pt_PKG_CONFIG" >&5
+echo "${ECHO_T}$ac_pt_PKG_CONFIG" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  PKG_CONFIG=$ac_pt_PKG_CONFIG
+else
+  PKG_CONFIG="$ac_cv_path_PKG_CONFIG"
+fi
+
+fi
+if test -n "$PKG_CONFIG"; then
+	_pkg_min_version=0.9.0
+	echo "$as_me:$LINENO: checking pkg-config is at least version $_pkg_min_version" >&5
+echo $ECHO_N "checking pkg-config is at least version $_pkg_min_version... $ECHO_C" >&6
+	if $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version; then
+		echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+	else
+		echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+		PKG_CONFIG=""
+	fi
+fi
 # On IRIX 5.3, sys/types and inttypes.h are conflicting.
 
 
@@ -3267,98 +3415,287 @@
 
 
 
-  succeeded=no
-
-  if test -z "$PKG_CONFIG"; then
-    # Extract the first word of "pkg-config", so it can be a program name with args.
-set dummy pkg-config; ac_word=$2
-echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_path_PKG_CONFIG+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+pkg_failed=no
+echo "$as_me:$LINENO: checking for COM_ERR" >&5
+echo $ECHO_N "checking for COM_ERR... $ECHO_C" >&6
+
+if test -n "$COM_ERR_CFLAGS"; then
+    pkg_cv_COM_ERR_CFLAGS="$COM_ERR_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { (echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"com_err\"") >&5
+  ($PKG_CONFIG --exists --print-errors "com_err") 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; then
+  pkg_cv_COM_ERR_CFLAGS=`$PKG_CONFIG --cflags "com_err" 2>/dev/null`
 else
-  case $PKG_CONFIG in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$COM_ERR_LIBS"; then
+    pkg_cv_COM_ERR_LIBS="$COM_ERR_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { (echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"com_err\"") >&5
+  ($PKG_CONFIG --exists --print-errors "com_err") 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; then
+  pkg_cv_COM_ERR_LIBS=`$PKG_CONFIG --libs "com_err" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
-  test -z "$ac_cv_path_PKG_CONFIG" && ac_cv_path_PKG_CONFIG="no"
-  ;;
-esac
+
+
+if test $pkg_failed = yes; then
+   	echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-PKG_CONFIG=$ac_cv_path_PKG_CONFIG
+        if test $_pkg_short_errors_supported = yes; then
+	        COM_ERR_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "com_err" 2>&1`
+        else
+	        COM_ERR_PKG_ERRORS=`$PKG_CONFIG --print-errors "com_err" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$COM_ERR_PKG_ERRORS" >&5
 
-if test -n "$PKG_CONFIG"; then
-  echo "$as_me:$LINENO: result: $PKG_CONFIG" >&5
-echo "${ECHO_T}$PKG_CONFIG" >&6
+
+  echo "$as_me:$LINENO: checking for com_err in -lcom_err" >&5
+echo $ECHO_N "checking for com_err in -lcom_err... $ECHO_C" >&6
+if test "${ac_cv_lib_com_err_com_err+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lcom_err  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char com_err ();
+int
+main ()
+{
+com_err ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_cv_lib_com_err_com_err=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_cv_lib_com_err_com_err=no
+fi
+rm -f conftest.err conftest.$ac_objext \
+      conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: $ac_cv_lib_com_err_com_err" >&5
+echo "${ECHO_T}$ac_cv_lib_com_err_com_err" >&6
+if test $ac_cv_lib_com_err_com_err = yes; then
+  COM_ERR_LIBS=-lcom_err
 fi
 
+  if test "x$COM_ERR_LIBS" = "x"; then
+    { { echo "$as_me:$LINENO: error: Unable to find com_err library" >&5
+echo "$as_me: error: Unable to find com_err library" >&2;}
+   { (exit 1); exit 1; }; }
   fi
+  if test "${ac_cv_header_et_com_err_h+set}" = set; then
+  echo "$as_me:$LINENO: checking for et/com_err.h" >&5
+echo $ECHO_N "checking for et/com_err.h... $ECHO_C" >&6
+if test "${ac_cv_header_et_com_err_h+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: $ac_cv_header_et_com_err_h" >&5
+echo "${ECHO_T}$ac_cv_header_et_com_err_h" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking et/com_err.h usability" >&5
+echo $ECHO_N "checking et/com_err.h usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+$ac_includes_default
+#include <et/com_err.h>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-  if test "$PKG_CONFIG" = "no" ; then
-     echo "*** The pkg-config script could not be found. Make sure it is"
-     echo "*** in your path, or set the PKG_CONFIG environment variable"
-     echo "*** to the full path to pkg-config."
-     echo "*** Or see http://www.freedesktop.org/software/pkgconfig to get pkg-config."
+ac_header_compiler=no
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking et/com_err.h presence" >&5
+echo $ECHO_N "checking et/com_err.h presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <et/com_err.h>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
   else
-     PKG_CONFIG_MIN_VERSION=0.9.0
-     if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
-        echo "$as_me:$LINENO: checking for com_err" >&5
-echo $ECHO_N "checking for com_err... $ECHO_C" >&6
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-        if $PKG_CONFIG --exists "com_err" ; then
-            echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
-            succeeded=yes
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
 
-            echo "$as_me:$LINENO: checking COM_ERR_CFLAGS" >&5
-echo $ECHO_N "checking COM_ERR_CFLAGS... $ECHO_C" >&6
-            COM_ERR_CFLAGS=`$PKG_CONFIG --cflags "com_err"`
-            echo "$as_me:$LINENO: result: $COM_ERR_CFLAGS" >&5
-echo "${ECHO_T}$COM_ERR_CFLAGS" >&6
-
-            echo "$as_me:$LINENO: checking COM_ERR_LIBS" >&5
-echo $ECHO_N "checking COM_ERR_LIBS... $ECHO_C" >&6
-            COM_ERR_LIBS=`$PKG_CONFIG --libs "com_err"`
-            echo "$as_me:$LINENO: result: $COM_ERR_LIBS" >&5
-echo "${ECHO_T}$COM_ERR_LIBS" >&6
-        else
-            COM_ERR_CFLAGS=""
-            COM_ERR_LIBS=""
-            ## If we have a custom action on failure, don't print errors, but
-            ## do set a variable so people can do so.
-            COM_ERR_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "com_err"`
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
+  yes:no: )
+    { echo "$as_me:$LINENO: WARNING: et/com_err.h: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: et/com_err.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: et/com_err.h: proceeding with the compiler's result" >&5
+echo "$as_me: WARNING: et/com_err.h: proceeding with the compiler's result" >&2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { echo "$as_me:$LINENO: WARNING: et/com_err.h: present but cannot be compiled" >&5
+echo "$as_me: WARNING: et/com_err.h: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: et/com_err.h:     check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: et/com_err.h:     check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: et/com_err.h: see the Autoconf documentation" >&5
+echo "$as_me: WARNING: et/com_err.h: see the Autoconf documentation" >&2;}
+    { echo "$as_me:$LINENO: WARNING: et/com_err.h:     section \"Present But Cannot Be Compiled\"" >&5
+echo "$as_me: WARNING: et/com_err.h:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { echo "$as_me:$LINENO: WARNING: et/com_err.h: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: et/com_err.h: proceeding with the preprocessor's result" >&2;}
+    { echo "$as_me:$LINENO: WARNING: et/com_err.h: in the future, the compiler will take precedence" >&5
+echo "$as_me: WARNING: et/com_err.h: in the future, the compiler will take precedence" >&2;}
+    (
+      cat <<\_ASBOX
+## ------------------------------------------ ##
+## Report this to the AC_PACKAGE_NAME lists.  ##
+## ------------------------------------------ ##
+_ASBOX
+    ) |
+      sed "s/^/$as_me: WARNING:     /" >&2
+    ;;
+esac
+echo "$as_me:$LINENO: checking for et/com_err.h" >&5
+echo $ECHO_N "checking for et/com_err.h... $ECHO_C" >&6
+if test "${ac_cv_header_et_com_err_h+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_cv_header_et_com_err_h=$ac_header_preproc
+fi
+echo "$as_me:$LINENO: result: $ac_cv_header_et_com_err_h" >&5
+echo "${ECHO_T}$ac_cv_header_et_com_err_h" >&6
 
-        fi
+fi
+if test $ac_cv_header_et_com_err_h = yes; then
+  :
+else
+  { { echo "$as_me:$LINENO: error: Unable to find com_err headers" >&5
+echo "$as_me: error: Unable to find com_err headers" >&2;}
+   { (exit 1); exit 1; }; }
+fi
 
 
 
-     else
-        echo "*** Your version of pkg-config is too old. You need version $PKG_CONFIG_MIN_VERSION or newer."
-        echo "*** See http://www.freedesktop.org/software/pkgconfig"
-     fi
-  fi
 
-  if test $succeeded = yes; then
-     :
-  else
+elif test $pkg_failed = untried; then
+     	echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 
   echo "$as_me:$LINENO: checking for com_err in -lcom_err" >&5
 echo $ECHO_N "checking for com_err in -lcom_err... $ECHO_C" >&6
@@ -3581,8 +3918,13 @@
 
 
 
-  fi
+else
+	COM_ERR_CFLAGS=$pkg_cv_COM_ERR_CFLAGS
+	COM_ERR_LIBS=$pkg_cv_COM_ERR_LIBS
+        echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
 
+fi
 
 UUID_LIBS=
 echo "$as_me:$LINENO: checking for uuid_unparse in -luuid" >&5
@@ -5569,8 +5911,8 @@
         fi
         # TRY="$TRY"
 
-        saved_LDFLAGS="$LDFLAGS"
-        LDFLAGS="$LDFLAGS $TRY -lcpg"
+        saved_LIBS="$LIBS"
+        LIBS="$LIBS $TRY -lcpg"
         cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -5623,7 +5965,7 @@
 fi
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
-        LDFLAGS="$saved_LDFLAGS"
+        LIBS="$saved_LIBS"
 
         if test "x$cpg_found" = "xyes"; then
             CPG_LDFLAGS="$TRY"
@@ -5720,8 +6062,8 @@
         fi
         # TRY="$TRY"
 
-        saved_LDFLAGS="$LDFLAGS"
-        LDFLAGS="$LDFLAGS $TRY -lSaCkpt"
+        saved_LIBS="$LIBS"
+        LIBS="$LIBS $TRY -lSaCkpt"
         cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -5774,7 +6116,7 @@
 fi
 rm -f conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
-        LDFLAGS="$saved_LDFLAGS"
+        LIBS="$saved_LIBS"
 
         if test "x$ckpt_found" = "xyes"; then
             AIS_LDFLAGS="$TRY"
@@ -6435,102 +6777,76 @@
 
   HAVE_BLKID=
 
-  succeeded=no
-
-  if test -z "$PKG_CONFIG"; then
-    # Extract the first word of "pkg-config", so it can be a program name with args.
-set dummy pkg-config; ac_word=$2
-echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_path_PKG_CONFIG+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+pkg_failed=no
+echo "$as_me:$LINENO: checking for BLKID" >&5
+echo $ECHO_N "checking for BLKID... $ECHO_C" >&6
+
+if test -n "$BLKID_CFLAGS"; then
+    pkg_cv_BLKID_CFLAGS="$BLKID_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { (echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"blkid >= 1.36\"") >&5
+  ($PKG_CONFIG --exists --print-errors "blkid >= 1.36") 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; then
+  pkg_cv_BLKID_CFLAGS=`$PKG_CONFIG --cflags "blkid >= 1.36" 2>/dev/null`
 else
-  case $PKG_CONFIG in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-
-  test -z "$ac_cv_path_PKG_CONFIG" && ac_cv_path_PKG_CONFIG="no"
-  ;;
-esac
+  pkg_failed=yes
 fi
-PKG_CONFIG=$ac_cv_path_PKG_CONFIG
-
-if test -n "$PKG_CONFIG"; then
-  echo "$as_me:$LINENO: result: $PKG_CONFIG" >&5
-echo "${ECHO_T}$PKG_CONFIG" >&6
+ else
+    pkg_failed=untried
+fi
+if test -n "$BLKID_LIBS"; then
+    pkg_cv_BLKID_LIBS="$BLKID_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { (echo "$as_me:$LINENO: \$PKG_CONFIG --exists --print-errors \"blkid >= 1.36\"") >&5
+  ($PKG_CONFIG --exists --print-errors "blkid >= 1.36") 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; then
+  pkg_cv_BLKID_LIBS=`$PKG_CONFIG --libs "blkid >= 1.36" 2>/dev/null`
 else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-  fi
 
-  if test "$PKG_CONFIG" = "no" ; then
-     echo "*** The pkg-config script could not be found. Make sure it is"
-     echo "*** in your path, or set the PKG_CONFIG environment variable"
-     echo "*** to the full path to pkg-config."
-     echo "*** Or see http://www.freedesktop.org/software/pkgconfig to get pkg-config."
-  else
-     PKG_CONFIG_MIN_VERSION=0.9.0
-     if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
-        echo "$as_me:$LINENO: checking for blkid >= 1.36" >&5
-echo $ECHO_N "checking for blkid >= 1.36... $ECHO_C" >&6
 
-        if $PKG_CONFIG --exists "blkid >= 1.36" ; then
-            echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
-            succeeded=yes
+if test $pkg_failed = yes; then
+   	echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 
-            echo "$as_me:$LINENO: checking BLKID_CFLAGS" >&5
-echo $ECHO_N "checking BLKID_CFLAGS... $ECHO_C" >&6
-            BLKID_CFLAGS=`$PKG_CONFIG --cflags "blkid >= 1.36"`
-            echo "$as_me:$LINENO: result: $BLKID_CFLAGS" >&5
-echo "${ECHO_T}$BLKID_CFLAGS" >&6
-
-            echo "$as_me:$LINENO: checking BLKID_LIBS" >&5
-echo $ECHO_N "checking BLKID_LIBS... $ECHO_C" >&6
-            BLKID_LIBS=`$PKG_CONFIG --libs "blkid >= 1.36"`
-            echo "$as_me:$LINENO: result: $BLKID_LIBS" >&5
-echo "${ECHO_T}$BLKID_LIBS" >&6
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        BLKID_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "blkid >= 1.36" 2>&1`
         else
-            BLKID_CFLAGS=""
-            BLKID_LIBS=""
-            ## If we have a custom action on failure, don't print errors, but
-            ## do set a variable so people can do so.
-            BLKID_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "blkid >= 1.36"`
-
+	        BLKID_PKG_ERRORS=`$PKG_CONFIG --print-errors "blkid >= 1.36" 2>&1`
         fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$BLKID_PKG_ERRORS" >&5
 
-
-
-     else
-        echo "*** Your version of pkg-config is too old. You need version $PKG_CONFIG_MIN_VERSION or newer."
-        echo "*** See http://www.freedesktop.org/software/pkgconfig"
-     fi
-  fi
-
-  if test $succeeded = yes; then
-     HAVE_BLKID=yes
-  else
-     { echo "$as_me:$LINENO: WARNING: blkid >= 1.36 not found, using internal version" >&5
+	{ echo "$as_me:$LINENO: WARNING: blkid >= 1.36 not found, using internal version" >&5
 echo "$as_me: WARNING: blkid >= 1.36 not found, using internal version" >&2;}
-  fi
-
+elif test $pkg_failed = untried; then
+     	echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+	{ echo "$as_me:$LINENO: WARNING: blkid >= 1.36 not found, using internal version" >&5
+echo "$as_me: WARNING: blkid >= 1.36 not found, using internal version" >&2;}
+else
+	BLKID_CFLAGS=$pkg_cv_BLKID_CFLAGS
+	BLKID_LIBS=$pkg_cv_BLKID_LIBS
+        echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+	HAVE_BLKID=yes
+fi
 
 
   if test "x$HAVE_BLKID" != "xyes"; then
@@ -8921,6 +9237,9 @@
 s,@root_sbindir@,$root_sbindir,;t t
 s,@root_sysconfdir@,$root_sysconfdir,;t t
 s,@PKG_CONFIG@,$PKG_CONFIG,;t t
+s,@PKG_CONFIG_PATH@,$PKG_CONFIG_PATH,;t t
+s,@PKG_CONFIG_LIBDIR@,$PKG_CONFIG_LIBDIR,;t t
+s,@ac_pt_PKG_CONFIG@,$ac_pt_PKG_CONFIG,;t t
 s,@COM_ERR_CFLAGS@,$COM_ERR_CFLAGS,;t t
 s,@COM_ERR_LIBS@,$COM_ERR_LIBS,;t t
 s,@UUID_LIBS@,$UUID_LIBS,;t t
Index: ocfs2-tools-1.6.3/configure.in
===================================================================
--- ocfs2-tools-1.6.3.orig/configure.in	2010-09-16 11:45:41.000000000 -0500
+++ ocfs2-tools-1.6.3/configure.in	2011-01-13 12:29:56.000000000 -0600
@@ -280,11 +280,11 @@
         fi
         # TRY="$TRY"
 
-        saved_LDFLAGS="$LDFLAGS"
-        LDFLAGS="$LDFLAGS $TRY -lcpg"
+        saved_LIBS="$LIBS"
+        LIBS="$LIBS $TRY -lcpg"
         AC_LINK_IFELSE([AC_LANG_CALL([], [cpg_initialize])],
         	       cpg_found=yes)
-        LDFLAGS="$saved_LDFLAGS"
+        LIBS="$saved_LIBS"
 
         if test "x$cpg_found" = "xyes"; then
             CPG_LDFLAGS="$TRY"
@@ -324,11 +324,11 @@
         fi
         # TRY="$TRY"
 
-        saved_LDFLAGS="$LDFLAGS"
-        LDFLAGS="$LDFLAGS $TRY -lSaCkpt"
+        saved_LIBS="$LIBS"
+        LIBS="$LIBS $TRY -lSaCkpt"
         AC_LINK_IFELSE([AC_LANG_CALL([], [saCkptInitialize])],
         	       ckpt_found=yes)
-        LDFLAGS="$saved_LDFLAGS"
+        LIBS="$saved_LIBS"
 
         if test "x$ckpt_found" = "xyes"; then
             AIS_LDFLAGS="$TRY"
